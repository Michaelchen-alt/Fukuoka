<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>九州・福岡小旅行 2026</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #001e43; /* 博多織深藍 */
            --accent: #e57373;  /* 櫻花粉紅/明太子色 */
            --bg: #fdfdfd;
        }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            color: #2d3748;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .bottom-nav-item.active { color: var(--accent); }
        .day-tab.active, .guide-day-tab.active { 
            background-color: var(--primary) !important; 
            color: white !important;
            border-radius: 12px;
        }
        .custom-shadow { box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        input, textarea, select { font-size: 16px !important; }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 11px;
            padding: 6px 10px;
            border-radius: 10px;
            font-weight: 700;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
        }
        .map-btn { background-color: #f1f5f9; color: var(--primary); }
        .search-btn { background-color: #fff1f2; color: #e11d48; }
        .action-btn:active { transform: scale(0.95); opacity: 0.8; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        table { border-collapse: separate; border-spacing: 0; }
        .order-btn {
            padding: 4px 6px; font-size: 12px; border-radius: 6px;
            background-color: #f8fafc; color: #64748b; border: 1px solid #e2e8f0;
        }
        .tip-card { border-left: 5px solid var(--primary); transition: transform 0.2s; }
        /* 燈箱樣式 */
        #lightbox.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="pb-28">

    <!-- Header -->
    <header class="bg-[#001e43] text-white p-5 sticky top-0 z-40 shadow-xl">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-xl font-black tracking-tighter">九州・福岡 2026</h1>
                <p class="text-[10px] opacity-70 uppercase tracking-widest font-bold">Family Travel Planner</p>
            </div>
            <div class="text-right">
                <div class="bg-amber-400 text-[#001e43] px-2 py-0.5 rounded-md font-black text-[10px]">CI116/CI117</div>
            </div>
        </div>
    </header>

    <main class="w-full md:max-w-screen-md mx-auto">

        <!-- PLAN (行程表) -->
        <section id="plan" class="tab-content active animate-in fade-in duration-500">
            <div class="bg-slate-900 p-5 mb-1 shadow-lg text-white relative overflow-hidden">
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-indigo-500/20 rounded-full blur-3xl"></div>
                <h3 class="text-xs font-black text-amber-400 mb-4 uppercase tracking-widest flex items-center gap-2"><i class="fas fa-plane"></i> 航班資訊</h3>
                <div class="grid grid-cols-1 gap-3 text-xs">
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/10">
                        <span class="bg-indigo-500 px-2 py-0.5 rounded font-bold uppercase tracking-wider">去程 2/08 (日)</span>
                        <p class="mt-2 font-black"><span class="text-amber-400">CI116</span> 16:25 TPE T2 → 19:35 FUK I</p>
                        <p class="text-[9px] opacity-60 mt-1 italic font-bold tracking-widest">AIRBUS A330-300</p>
                    </div>
                    <div class="bg-white/5 p-4 rounded-2xl border border-white/10">
                        <span class="bg-rose-500 px-2 py-0.5 rounded font-bold uppercase tracking-wider">回程 2/14 (六)</span>
                        <p class="mt-2 font-black"><span class="text-amber-400">CI117</span> 20:35 FUK I → 22:20 TPE T2</p>
                        <p class="text-[9px] opacity-60 mt-1 italic font-bold tracking-widest">AIRBUS A321NEO</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-5 mb-4 shadow-sm border-b border-slate-100">
                <h3 class="text-xs font-black text-slate-400 mb-4 uppercase tracking-widest flex items-center gap-2"><i class="fas fa-bed"></i> 住宿安排</h3>
                <div class="space-y-4 text-sm font-bold text-slate-700">
                    <div class="flex justify-between items-center"><span>2/08 (日) 博多西中州東橫INN</span><button onclick="openMap('博多西中州東橫INN')" class="action-btn map-btn">Map</button></div>
                    <div class="flex justify-between items-center border-t border-slate-50 pt-4"><span>2/09 (一) 别府龜之井酒店</span><button onclick="openMap('别府龜之井酒店')" class="action-btn map-btn">Map</button></div>
                    <div class="flex justify-between items-center border-t border-slate-50 pt-4"><div>2/10 (二) 小倉站南東橫INN<p class="text-rose-500 text-[10px] font-black">停車費每晚 500 日幣</p></div><button onclick="openMap('小倉站南東橫INN')" class="action-btn map-btn">Map</button></div>
                    <div class="flex justify-between items-center border-t border-slate-50 pt-4"><span>2/11 (三) - 2/14 (六) 博多大和魯內飯店</span><button onclick="openMap('博多大和魯內飯店')" class="action-btn map-btn">Map</button></div>
                </div>
            </div>

            <div class="flex min-h-[500px]">
                <div class="w-16 flex-shrink-0 bg-slate-50 flex flex-col border-r border-slate-100 font-black">
                    <button onclick="switchDay(1)" id="day-btn-1" class="day-tab flex-1 py-4 text-xs">D1</button>
                    <button onclick="switchDay(2)" id="day-btn-2" class="day-tab flex-1 py-4 text-xs">D2</button>
                    <button onclick="switchDay(3)" id="day-btn-3" class="day-tab flex-1 py-4 text-xs">D3</button>
                    <button onclick="switchDay(4)" id="day-btn-4" class="day-tab flex-1 py-4 text-xs">D4</button>
                    <button onclick="switchDay(5)" id="day-btn-5" class="day-tab flex-1 py-4 text-xs">D5</button>
                    <button onclick="switchDay(6)" id="day-btn-6" class="day-tab flex-1 py-4 text-xs">D6</button>
                    <button onclick="switchDay(7)" id="day-btn-7" class="day-tab flex-1 py-4 text-xs">D7</button>
                </div>
                <div id="day-content" class="flex-1 bg-white p-4 overflow-y-auto no-scrollbar"></div>
            </div>
        </section>

        <!-- GUIDE (深度導覽) -->
        <section id="guide" class="tab-content animate-in slide-in-from-right duration-500">
            <div class="flex min-h-[500px]">
                <div class="w-16 flex-shrink-0 bg-indigo-50 flex flex-col border-r border-indigo-100 font-black">
                    <button onclick="switchGuideDay(1)" id="guide-day-btn-1" class="guide-day-tab flex-1 py-4 text-xs text-indigo-300">D1</button>
                    <button onclick="switchGuideDay(2)" id="guide-day-btn-2" class="guide-day-tab flex-1 py-4 text-xs text-indigo-300">D2</button>
                    <button onclick="switchGuideDay(3)" id="guide-day-btn-3" class="guide-day-tab flex-1 py-4 text-xs text-indigo-300">D3</button>
                    <button onclick="switchGuideDay(4)" id="guide-day-btn-4" class="guide-day-tab flex-1 py-4 text-xs text-indigo-300">D4</button>
                    <button onclick="switchGuideDay(5)" id="guide-day-btn-5" class="guide-day-tab flex-1 py-4 text-xs text-indigo-300">D5</button>
                    <button onclick="switchGuideDay(6)" id="guide-day-btn-6" class="guide-day-tab flex-1 py-4 text-xs text-indigo-300">D6</button>
                    <button onclick="switchGuideDay(7)" id="guide-day-btn-7" class="guide-day-tab flex-1 py-4 text-xs text-indigo-300">D7</button>
                </div>
                <div id="guide-content" class="flex-1 bg-white p-5 overflow-y-auto no-scrollbar"></div>
            </div>
        </section>

        <!-- WALLET (記帳) -->
        <section id="wallet" class="tab-content animate-in p-0">
            <div class="bg-slate-900 p-6 text-white shadow-xl relative overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-[10px] font-bold opacity-60 uppercase tracking-widest text-amber-200 font-black">台灣銀行賣出即期匯率 (JPY)</span>
                    <a href="https://rate.bot.com.tw/xrt?Lang=zh-tw&redirect=true" target="_blank" class="bg-indigo-600 text-[10px] px-3 py-1 rounded-full border border-indigo-400 font-black text-center">台銀官網</a>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-bold opacity-50 uppercase tracking-tighter">1 JPY =</span>
                    <input id="rate-input" type="number" step="0.0001" value="0.2059" class="bg-white/10 rounded-lg px-2 py-1 text-2xl font-black w-28 text-amber-400 border-none focus:ring-1 ring-amber-400" oninput="calculateInstantTWD()">
                </div>
            </div>
            <div class="bg-white p-6 shadow-md border-b border-slate-100">
                <div class="space-y-4">
                    <input id="exp-item" type="text" placeholder="消費項目名稱" class="w-full bg-slate-50 rounded-xl px-4 py-3 border-none text-sm font-bold focus:ring-1 ring-indigo-200">
                    <div class="flex gap-4">
                        <div class="flex-1">
                            <input id="exp-amount" type="number" placeholder="JPY 金額" class="w-full bg-slate-50 rounded-xl px-4 py-3 border-none text-sm font-black focus:ring-1 ring-indigo-200" oninput="calculateInstantTWD()">
                        </div>
                        <div class="flex-1 bg-emerald-50 rounded-xl px-4 py-3 text-sm font-black text-emerald-600">
                            NT$ <span id="instant-twd">0</span>
                        </div>
                    </div>
                    <div class="flex gap-3 pt-1">
                        <label class="flex-1 bg-slate-100 p-4 rounded-xl cursor-pointer flex items-center justify-center gap-2 active:bg-slate-200 transition-all">
                            <i class="fas fa-camera text-slate-600"></i>
                            <span class="text-xs font-black text-slate-600">拍照收據</span>
                            <input type="file" id="exp-photo" accept="image/*" capture="camera" class="hidden" onchange="handleImage(event)">
                        </label>
                        <button onclick="addExpense()" class="flex-[2] bg-indigo-600 text-white py-4 rounded-xl font-black shadow-lg shadow-indigo-100 active:scale-95 transition-transform">
                            紀錄此筆消費
                        </button>
                    </div>
                </div>
            </div>
            <div class="p-4 bg-slate-50 overflow-x-auto min-h-[300px]">
                <table class="w-full text-left bg-white rounded-2xl shadow-sm border border-slate-100 text-[11px] overflow-hidden font-bold">
                    <thead class="bg-slate-50 font-black text-slate-400 uppercase tracking-tighter">
                        <tr><th class="p-3">日期</th><th class="p-3">項目</th><th class="p-3 text-right">JPY</th><th class="p-3 text-right">TWD</th><th class="p-3 text-center">當時匯率</th><th class="p-3 text-center">收據</th><th class="p-3 text-center">順序</th><th class="p-3 text-center">刪除</th></tr>
                    </thead>
                    <tbody id="expense-list-table"></tbody>
                </table>
            </div>
            <div class="sticky bottom-20 left-0 right-0 p-4 z-30">
                <div class="bg-[#001e43] text-white p-4 rounded-3xl flex justify-between shadow-2xl border border-white/10">
                    <div class="flex-1 border-r border-white/10 pr-4"><p class="text-[8px] font-bold opacity-50 uppercase tracking-widest">Total JPY 加總</p><p class="text-lg font-black text-amber-400">¥ <span id="total-jpy">0</span></p></div>
                    <div class="flex-1 pl-4 text-right"><p class="text-[8px] font-bold opacity-50 uppercase tracking-widest">Total TWD 加總</p><p class="text-lg font-black text-emerald-400">NT$ <span id="total-twd">0</span></p></div>
                </div>
            </div>
        </section>

        <!-- WEATHER -->
        <section id="weather" class="tab-content animate-in p-5">
            <h2 class="text-2xl font-black text-slate-800 mb-6 italic px-2">天氣預報</h2>
            <div class="space-y-6">
                <div class="bg-sky-600 rounded-[2.5rem] p-6 text-white shadow-xl relative overflow-hidden">
                    <i class="fas fa-cloud-sun text-7xl absolute -right-4 -bottom-4 opacity-10"></i>
                    <h4 class="text-lg font-black mb-1 relative z-10 font-bold tracking-tight">福岡市 (Fukuoka)</h4>
                    <a href="https://www.jma.go.jp/bosai/forecast/#area_type=offices&area_code=400000" target="_blank" class="w-full bg-white text-sky-600 py-4 rounded-2xl font-black text-center block mt-4 shadow-lg active:scale-95 relative z-10 transition-transform font-bold">詳細預報官網</a>
                </div>
                <div class="bg-indigo-800 rounded-[2.5rem] p-6 text-white shadow-xl relative overflow-hidden">
                    <i class="fas fa-mountain text-7xl absolute -right-4 -bottom-4 opacity-10"></i>
                    <h4 class="text-lg font-black mb-1 relative z-10 font-bold tracking-tight">別府 / 大分 (Beppu)</h4>
                    <a href="https://www.jma.go.jp/bosai/forecast/#area_type=offices&area_code=440000" target="_blank" class="w-full bg-white text-indigo-800 py-4 rounded-2xl font-black text-center block mt-4 shadow-lg active:scale-95 relative z-10 transition-transform font-bold">詳細預報官網</a>
                </div>
            </div>
        </section>

        <!-- OTHER -->
        <section id="other" class="tab-content animate-in p-5">
            <h2 class="text-2xl font-black text-slate-800 mb-6 italic px-2 flex items-center gap-2"><i class="fas fa-lightbulb text-amber-500"></i> 旅遊建議貼士</h2>
            <div class="space-y-4">
                <div class="tip-card bg-white p-5 rounded-2xl shadow-sm border-l-indigo-900 border border-slate-50">
                    <div class="font-black text-indigo-900 mb-2 text-sm font-bold tracking-tight"><i class="fas fa-car-side"></i> 自駕注意事項 (Day 2-4)</div>
                    <p class="text-[11px] text-slate-500 leading-relaxed font-bold"><b>ETC 提醒：</b> 您已經領取了 TEP，但請確保取車時 AVIS 有提供 ETC 卡片 (租卡費約 330円)，否則無法感應國道費。<br><b>別府山路：</b> 由布院前往別府路段多為彎曲山道，2月清晨或深夜可能有黑冰(薄冰)，請謹慎駕駛並確認雪胎配備。</p>
                </div>
                <div class="tip-card bg-white p-5 rounded-2xl shadow-sm border-l-rose-500 border border-slate-50">
                    <div class="font-black text-rose-600 mb-2 text-sm font-bold tracking-tight"><i class="fas fa-utensils"></i> 美食預約 (Day 3, Day 6)</div>
                    <p class="text-[11px] text-slate-500 leading-relaxed font-bold"><b>鍋島燒肉 (Day 3)：</b> 北九州熱門，建議抵日後即刻電話預約，以免排隊影響小倉行程。<br><b>大東園 (Day 6)：</b> 福岡指標燒肉名店，週末時段建議務必提早訂位。</p>
                </div>
                <div class="tip-card bg-white p-5 rounded-2xl shadow-sm border-l-emerald-500 border border-slate-50">
                    <div class="font-black text-emerald-600 mb-2 text-sm font-bold tracking-tight"><i class="fas fa-shopping-bag"></i> ON 鞋採購策略 (Day 5)</div>
                    <p class="text-[11px] text-slate-500 leading-relaxed font-bold mb-3">先查 <b>Sports Depo</b> 日本官網太宰府店庫存，確保有尺寸再前往。</p>
                    <a href="https://store.alpen-group.jp/Form/Product/ProductList.aspx?swrd=cloudsurfer+max" target="_blank" class="text-[10px] bg-emerald-50 text-emerald-600 px-3 py-2 rounded-xl font-black border border-emerald-100 flex items-center justify-center gap-2 active:scale-95 transition-all">
                        <i class="fas fa-external-link-alt"></i> Alpen 官網：Cloudsurfer Max 庫存查詢
                    </a>
                </div>
                <div class="tip-card bg-white p-5 rounded-2xl shadow-sm border-l-pink-400 border border-slate-50">
                    <div class="font-black text-pink-400 mb-2 text-sm font-bold tracking-tight"><i class="fas fa-camera-retro"></i> 梅花高峰攻略 (Day 5)</div>
                    <p class="text-[11px] text-slate-500 leading-relaxed font-bold">2月下旬高峰人潮眾多。建議 <b>09:00 前</b> 抵達太宰府，此時拍照光線最好且能避開大批團體客。</p>
                </div>
            </div>
        </section>

        <!-- MAP (新分頁) -->
        <section id="map" class="tab-content animate-in p-5">
            <h2 class="text-2xl font-black text-slate-800 mb-6 italic px-2">行程路線圖</h2>
            <div class="bg-white p-2 rounded-[2.5rem] custom-shadow border border-slate-50 relative group">
                <img src="旅行地圖.jpg" class="w-full rounded-[2rem] cursor-zoom-in active:scale-[0.98] transition-all" onclick="openLightbox(this.src)" alt="行程地圖">
                <div class="absolute bottom-6 right-6 bg-black/50 text-white p-3 rounded-full backdrop-blur-md pointer-events-none">
                    <i class="fas fa-search-plus"></i>
                </div>
            </div>
            <p class="text-center text-[11px] text-slate-400 mt-6 italic font-bold">點擊地圖可放大全螢幕觀看</p>
        </section>

    </main>

    <!-- Lightbox 全螢幕模態框 -->
    <div id="lightbox" class="fixed inset-0 bg-black/95 z-[100] hidden items-center justify-center p-4 cursor-zoom-out" onclick="this.classList.add('hidden')">
        <img id="lightbox-img" src="" class="max-w-full max-h-full object-contain rounded-lg">
        <button class="absolute top-10 right-6 text-white text-3xl opacity-70"><i class="fas fa-times"></i></button>
    </div>

    <!-- Bottom Nav -->
    <nav class="fixed bottom-0 left-0 right-0 glass-morphism border-t border-slate-100 p-3 pb-8 flex justify-around items-center z-50 rounded-t-[2.5rem] shadow-2xl md:max-w-screen-md md:mx-auto">
        <button onclick="switchTab('plan', this)" class="bottom-nav-item active flex flex-col items-center gap-1 transition-all"><i class="fas fa-calendar-alt text-lg"></i><span class="text-[9px] font-black uppercase">Plan</span></button>
        <button onclick="switchTab('guide', this)" class="bottom-nav-item flex flex-col items-center gap-1 transition-all"><i class="fas fa-map-marked-alt text-lg"></i><span class="text-[9px] font-black uppercase">Guide</span></button>
        <button onclick="switchTab('map', this)" class="bottom-nav-item flex flex-col items-center gap-1 transition-all"><i class="fas fa-route text-lg text-indigo-600"></i><span class="text-[9px] font-black uppercase">Map</span></button>
        <button onclick="switchTab('wallet', this)" class="bottom-nav-item flex flex-col items-center gap-1 transition-all"><i class="fas fa-wallet text-lg"></i><span class="text-[9px] font-black uppercase">Wallet</span></button>
        <button onclick="switchTab('weather', this)" class="bottom-nav-item flex flex-col items-center gap-1 transition-all"><i class="fas fa-cloud-sun text-lg"></i><span class="text-[9px] font-black uppercase">Weather</span></button>
        <button onclick="switchTab('other', this)" class="bottom-nav-item flex flex-col items-center gap-1 transition-all"><i class="fas fa-lightbulb text-lg"></i><span class="text-[9px] font-black uppercase">Other</span></button>
    </nav>

    <script>
        // --- 核心資料 ---
        let expenses = JSON.parse(localStorage.getItem('fukuoka_exp_v2')) || [];
        let currentImgBase64 = "";

        const dailyItinerary = {
            1: { date: "2/08", weekday: "日", title: "福岡抵達", items: [{ name: "福岡機場", note: "19:35 抵達國內航廈 B2" },{ name: "Lawson 福岡機場店", note: "領取 TEP 通行證" },{ name: "博多西中州東橫 INN", note: "辦理入住休息" },{ name: "中州屋台", note: "晚餐與屋台文化體驗" }] },
            2: { date: "2/09", weekday: "一", title: "啟程自駕", items: [{ name: "AVIS 天神取車", note: "09:00 前往渡邊大道店" },{ name: "由布院 九州", note: "金鱗湖與湯之坪步道散策" },{ name: "YouMe Town 別府", note: "吃晚餐與購物逛街" },{ name: "龟之井酒店", note: "別府溫泉住宿" }] },
            3: { date: "2/10", weekday: "二", title: "地獄與小倉", items: [{ name: "別府纜車", note: "搭乘纜車全景俯瞰" },{ name: "海地獄 九州", note: "地獄溫泉巡禮" },{ name: "灶地獄 九州", note: "地獄溫泉巡禮" },{ name: "燒肉鍋島 Nabeshima 九州", note: "在地推薦熱門午餐" },{ name: "小倉城", note: "九州歷史古蹟散策" },{ name: "照葉スパリゾート門司店", note: "泡湯放鬆休息" }] },
            4: { date: "2/11", weekday: "三", title: "門司港浪漫", items: [{ name: "門司港懷舊區", note: "藍翼吊橋、舊稅關" },{ name: "伽哩本舖 門司港", note: "燒咖哩午餐" },{ name: "SAINT city", note: "逛街" },{ name: "AVIS 天神渡邊大道店", note: "還車 約20:00" },{ name: "西中洲 DEL 時尚飯店", note: "入住" }] },
            5: { date: "2/12", weekday: "四", title: "太宰府賞梅", items: [{ name: "竈門神社 九州", note: "結緣神社參拜" },{ name: "太宰府天滿宮", note: "梅花祭高峰期" },{ name: "Sports Depo 太宰府店", note: "採購 ON 運動鞋" },{ name: "八百治博多飯店", note: "市區泡湯放鬆" }] },
            6: { date: "2/13", weekday: "五", title: "市區採買", items: [{ name: "櫛田神社 福岡", note: "博多總鎮守參拜" },{ name: "東長寺 福岡", note: "福岡大佛參觀" },{ name: "燒肉-大東園 離れ 祇園亭(大東園分店)", note: "晚餐" },{ name: "AEON", note: "逛逛" },{ name: "MINA", note: "逛逛" },{ name: "Full Full", note: "明太子法國麵包" },{ name: "PARCO百貨、天神地下街", note: "逛逛" },{ name: "西中洲 DEL 時尚飯店", note: "入住" }] },
            7: { date: "2/14", weekday: "六", title: "歸途準備", items: [{ name: "警固神社 福岡", note: "市區能量景點參拜" },{ name: "Bic CAMERA 福岡", note: "日本電器最後採買" },{ name: "福岡機場 (FUK)", note: "18:30 前報到" }] }
        };

        const guideData = {
            1: { title: "中州屋台攻略", spots: [{ name: "中州屋台", desc: "福岡夜晚的靈魂，沿著那珂川排列的屋台提供拉麵、牛雜鍋與烤串。推薦找一家順眼的進去體驗煙火氣。" }] },
            2: { title: "由布院山城散策", spots: [{ name: "由布院", desc: "擁有「金鱗湖」與「湯之坪步道」，是九州最受歡迎的溫泉小鎮。適合慢走、品嚐 B-speak 蛋糕捲。" }] },
            3: { title: "別府與小倉古城", spots: [
                { name: "別府纜車", desc: "登上鶴見岳俯瞰別府灣全景。2月山頂可能還有殘雪，壯闊無比。" },
                { name: "地獄溫泉", desc: "參觀海地獄、灶地獄等奇特景觀，體驗大自然的震撼。" },
                { name: "旦過市場", desc: "北九州的廚房，擁有百年歷史的傳統市場。" },
                { name: "小倉城", desc: "細川忠興修築的古城，特殊的「唐造」風格頂層非常壯觀。" }
            ]},
            4: { title: "門司港懷舊巡禮", spots: [
                { name: "門司港懷舊區", desc: "洋溢大正浪漫風情的貿易港，赤煉瓦建築群是必拍重點。" },
                { name: "大連友好紀念館", desc: "充滿歐式風情的華麗複製品建築。" },
                { name: "舊門司稅關", desc: "紅磚建築的代表，內部提供展示室與休息區。" },
                { name: "藍翼門司吊橋", desc: "日本唯一的步行者專用開合橋，整點會有美妙的開橋秀。" },
                { name: "大阪商船", desc: "獨特的八角形塔樓建築，曾是前往台灣航線的據點。" },
                { name: "舊門司三井俱樂部", desc: "愛因斯坦夫婦曾入住的地點，現為餐廳與展示室。" },
                { name: "JR 門司港站", desc: "九州最古老的車站建築，完全修復的大正風格木造車站。" }
            ]},
            5: { title: "太宰府求學與結緣", spots: [
                { name: "竈門神社", desc: "著名的結緣神社，建築風格現代且雅致。" },
                { name: "太宰府天滿宮", desc: "祭祀學問之神，2月下旬是梅花高峰，宮內約有6000株梅花。" }
            ]},
            6: { title: "博多信仰與生活", spots: [
                { name: "櫛田神社", desc: "博多總鎮守，是著名的博多祇園山笠祭典舞台。" },
                { name: "川端通商店街", desc: "福岡最古老的商店街，適合購買土產、傳統工藝品。" },
                { name: "東長寺", desc: "擁有日本最大的木造坐像「福岡大佛」。" }
            ]},
            7: { title: "警固平安之旅", spots: [
                { name: "警固神社", desc: "位於天神鬧區中的寧靜角落，守護著福岡市民的平安。" }
            ]}
        };

        function switchTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.bottom-nav-item').forEach(b => b.classList.remove('active'));
            el.classList.add('active'); window.scrollTo(0, 0);
        }

        function switchDay(n) {
            document.querySelectorAll('.day-tab').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById(`day-btn-${n}`);
            if (btn) btn.classList.add('active');
            const d = dailyItinerary[n];
            document.getElementById('day-content').innerHTML = `
                <h4 class="font-black text-slate-800 text-sm border-b-2 border-amber-400 pb-2 mb-4 tracking-tight uppercase font-bold">DAY ${n} | ${d.date} (${d.weekday}) ${d.title}</h4>
                <div class="space-y-4">
                    ${d.items.map(i => `
                        <div class="flex items-start gap-3 group animate-in slide-in-from-bottom duration-300">
                            <div class="w-1.5 h-1.5 bg-indigo-900 rounded-full mt-1.5 flex-shrink-0"></div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <p class="text-xs font-black text-slate-700 font-bold">${i.name}</p>
                                    <button onclick="openMap('${i.name}')" class="text-[10px] bg-slate-100 px-2 py-1 rounded-md text-slate-500 font-black"><i class="fas fa-location-arrow"></i></button>
                                </div>
                                <p class="text-[10px] text-slate-400 mt-1 font-medium italic">${i.note}</p>
                            </div>
                        </div>`).join('')}
                </div>`;
        }

        function switchGuideDay(n) {
            document.querySelectorAll('.guide-day-tab').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById(`guide-day-btn-${n}`);
            if (btn) btn.classList.add('active');
            const d = guideData[n];
            document.getElementById('guide-content').innerHTML = `
                <h4 class="font-black text-indigo-900 text-sm border-b-2 border-indigo-200 pb-2 mb-4 tracking-tight uppercase font-bold">DAY ${n} | 導覽內容</h4>
                <div class="space-y-8 mt-4">
                    ${d.spots.map(s => `
                        <div class="animate-in fade-in duration-500">
                            <div class="flex justify-between items-center mb-2">
                                <h5 class="font-black text-xs italic font-bold"># ${s.name}</h5>
                                <button onclick="openSearch('${s.name}')" class="text-[9px] bg-rose-50 px-2 py-1 rounded text-rose-500 italic font-bold border border-rose-100 transition-all active:scale-90">搜尋</button>
                            </div>
                            <p class="text-[10px] text-slate-500 leading-relaxed bg-slate-50 p-3 rounded-xl font-medium shadow-inner">${s.desc}</p>
                        </div>`).join('')}
                </div>`;
        }

        function openMap(q) { const o = q.includes('九州') || q.includes('福岡') ? q : q + ' 九州'; window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(o)}`, '_blank'); }
        function openSearch(q) { window.open(`https://www.google.com/search?q=${encodeURIComponent(q + ' 景點 介紹')}`, '_blank'); }
        function calculateInstantTWD() { const r = parseFloat(document.getElementById('rate-input').value) || 0; const a = parseFloat(document.getElementById('exp-amount').value) || 0; const res = Math.round(a * r); document.getElementById('instant-twd').innerText = res.toLocaleString(); return res; }
        function handleImage(e) { const f = e.target.files[0]; if (!f) return; const rd = new FileReader(); rd.onload = function(ev) { const i = new Image(); i.onload = function() { const c = document.createElement('canvas'); const ctx = c.getContext('2d'); c.width = 150; c.height = i.height * (150/i.width); ctx.drawImage(i, 0,0,150,c.height); currentImgBase64 = c.toDataURL('image/jpeg', 0.6); }; i.src = ev.target.result; }; rd.readAsDataURL(f); }
        
        function addExpense() { 
            const it = document.getElementById('exp-item').value, am = parseFloat(document.getElementById('exp-amount').value) || 0, ra = parseFloat(document.getElementById('rate-input').value) || 0; 
            if(!it || !am) return alert("請輸入品項與日圓金額"); 
            expenses.unshift({id: Date.now(), date: new Date().toLocaleDateString('zh-TW', {month:'2-digit', day:'2-digit'}), name: it, jpy: am, twd: Math.round(am*ra), rateUsed: ra, img: currentImgBase64}); 
            localStorage.setItem('fukuoka_exp_v2', JSON.stringify(expenses)); 
            renderExpenses(); 
            document.getElementById('exp-item').value=""; document.getElementById('exp-amount').value=""; document.getElementById('instant-twd').innerText="0"; currentImgBase64=""; 
        }

        function moveExpense(idx, dir) { 
            const n = idx + dir; 
            if(n >= 0 && n < expenses.length){ 
                const t = expenses[idx]; expenses[idx] = expenses[n]; expenses[n] = t; 
                localStorage.setItem('fukuoka_exp_v2', JSON.stringify(expenses)); 
                renderExpenses(); 
            } 
        }

        function deleteExpense(id) { 
            expenses = expenses.filter(e => e.id !== id); 
            localStorage.setItem('fukuoka_exp_v2', JSON.stringify(expenses)); 
            renderExpenses(); 
        }

        function renderExpenses() { 
            const tb = document.getElementById('expense-list-table'); 
            let tj = 0, tt = 0; 
            if(!tb) return;
            tb.innerHTML = expenses.map((e, i) => { 
                tj += e.jpy; tt += e.twd; 
                return `
                <tr class="border-b text-[11px] font-bold">
                    <td class="p-3 text-slate-400 font-bold">${e.date}</td>
                    <td class="p-3 text-slate-800 font-bold">${e.name}</td>
                    <td class="p-3 text-right font-bold">¥${e.jpy.toLocaleString()}</td>
                    <td class="p-3 text-right text-emerald-600 font-bold">NT$${e.twd.toLocaleString()}</td>
                    <td class="p-3 text-center text-slate-300 font-black">${e.rateUsed}</td>
                    <td class="p-3 text-center">${e.img ? `<img src="${e.img}" class="w-8 h-8 rounded mx-auto object-cover border border-slate-100 shadow-sm">` : '-'}</td>
                    <td class="p-3 text-center">
                        <div class="flex flex-col gap-1 items-center">
                            <button onclick="moveExpense(${i},-1)" class="order-btn">▲</button>
                            <button onclick="moveExpense(${i},1)" class="order-btn">▼</button>
                        </div>
                    </td>
                    <td class="p-3 text-center"><button onclick="deleteExpense(${e.id})" class="text-rose-400 active:scale-75 transition-transform"><i class="fas fa-trash-alt"></i></button></td>
                </tr>`;
            }).join(''); 
            document.getElementById('total-jpy').innerText = tj.toLocaleString(); 
            document.getElementById('total-twd').innerText = tt.toLocaleString();
        }

        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox').classList.remove('hidden');
        }

        window.onload = () => { switchDay(1); switchGuideDay(1); renderExpenses(); };
    </script>
</body>

</html>
